!function(e,i){var t=e.EnumerableUtils.forEach;i.EmbeddedJSONAdapter=i.RESTAdapter.extend({defaultSerializer:"ams_mongoid",pathForType:function(i){var t=e.String.decamelize(i);return e.String.pluralize(t)},ajaxError:function(r){var n=this._super(r);if(r&&422===r.status){var a=e.$.parseJSON(r.responseText).errors,o={};return t(e.keys(a),function(i){o[e.String.camelize(i)]=a[i]}),new i.InvalidError(o)}return n}})}(Ember,DS),function(e,i){var t=e.get,r=e.EnumerableUtils.forEach;i.EmbeddedJSONSerializer=i.RESTSerializer.extend(i.EmbeddedJSONMixin,{keyForAttribute:function(i){return e.String.decamelize(i)},keyForRelationship:function(i,t){return i=e.String.decamelize(i),"belongsTo"===t?i+"_id":"hasMany"===t?e.String.singularize(i)+"_ids":i},serializeIntoHash:function(i,t,r,n){var a=e.String.decamelize(t.typeKey);i[a]=this.serialize(r,n)},serializePolymorphicType:function(i,r,n){var a=n.key,o=t(i,a);o&&(a=this.keyForAttribute(a),r[a+"_type"]=e.String.capitalize(o.constructor.typeKey))},typeForRoot:function(i){var t=e.String.camelize(i);return e.String.singularize(t)},normalize:function(e,i,t){return this.normalizeLinks(i),this._super(e,i,t)},normalizeLinks:function(i){if(i.links){var t=i.links;for(var r in t){var n=e.String.camelize(r);n!==r&&(t[n]=t[r],delete t[r])}}},normalizeRelationships:function(e,i){var t,n;this.keyForRelationship&&e.eachRelationship(function(e,a){if(a.options.polymorphic){if(t=this.keyForAttribute(e),n=i[t],n&&n.type)n.type=this.typeForRoot(n.type);else if(n&&"hasMany"===a.kind){var o=this;r(n,function(e){e.type=o.typeForRoot(e.type)})}}else t=this.keyForRelationship(e,a.kind),n=i[t];i[e]=n,e!==t&&delete i[t]},this)}})}(Ember,DS),Ember.onLoad("Ember.Application",function(e){e.initializer({name:"embeddedJSONAdapter",initialize:function(e,i){i.register("serializer:embedded_json",DS.EmbeddedJSONSerializer),i.register("adapter:embedded_json",DS.EmbeddedJSONAdapter)}})}),function(e,i){function t(e){return e&&("always"===e.embedded||"load"===e.embedded)}function r(e,i){var t=e+"_id";i.hasOwnProperty(t)&&delete i[t]}function n(e,i,r,n){var l=s(this,"attrs");l&&i.eachRelationship(function(i,s){var u=l[i];t(u)&&("hasMany"===s.kind&&a.call(this,e,i,s,r,n),"belongsTo"===s.kind&&o.call(this,e,i,s,r,n))},this)}function a(i,t,r,a,o){var u=i.serializerFor(r.type.typeKey),y=s(this,"primaryKey"),d="_"+e.String.pluralize(r.type.typeKey),p=this.keyForRelationship(t,r.kind),h=this.keyForAttribute(t),c=[];o[h]&&(a[d]=a[d]||[],l(o[h],function(e){var t=i.modelFor(r.type.typeKey);n.call(u,i,t,a,e),c.push(e[y]),a[d].push(e)}),o[p]=c,delete o[h])}function o(i,r,n,a,o){var l=this.get("attrs");if(l&&(t(l[e.String.camelize(r)])||t(l[r]))){var u=i.serializerFor(n.type.typeKey),y=(s(u,"primaryKey"),e.String.pluralize(n.type.typeKey)),d=u.keyForRelationship(r,n.kind),p=u.keyForAttribute(r);if(o[p]){a[y]=a[y]||[];{i.modelFor(n.type.typeKey)}o[d]=o[p].id,a[y].push(o[p]),o[p][n.parentType.typeKey+"_id"]=o.id,delete o[p]}}}var s=e.get,l=e.EnumerableUtils.forEach;i.EmbeddedJSONMixin=e.Mixin.create({serializeBelongsTo:function(e,i,n){var a=n.key,o=this.get("attrs");if(!o||!t(o[a]))return this._super(e,i,n),void 0;var s=this.keyForAttribute(a),l=e.get(a);if(l){i[s]=l.serialize();var u=l.get("id");u&&(i[s].id=u);var y=this.keyForAttribute(n.parentType.typeKey);y&&r(y,i[s]),delete i[s][y]}else i[s]=null},serializeHasMany:function(e,i,r){var n=r.key,a=this.get("attrs");if(!a||!t(a[n]))return this._super(e,i,r),void 0;var o=this.keyForAttribute(n);i[o]=s(e,n).map(function(e){var i=e.serialize(),t=s(this,"primaryKey");return i[t]=s(e,t),null===i.id&&delete i.id,i},this)},extractSingle:function(e,i,t,r,a){var o=this.keyForAttribute(i.typeKey),s=t[o];return n.call(this,e,i,t,s),this._super(e,i,t,r,a)},extractArray:function(i,t,r){var a=this.keyForAttribute(t.typeKey),o=r[e.String.pluralize(a)];return l(o,function(e){n.call(this,i,t,r,e)},this),this._super(i,t,r)}})}(Ember,DS);