var forEach=Ember.EnumerableUtils.forEach;DS.EmbeddedAdapter=DS.RESTAdapter.extend(DS.UnderscoredAdapterMixin,{defaultSerializer:"_embedded",ajax:function(e,i,r){var t,n;return t=this,n=r,new Ember.RSVP.Promise(function(a,o){return r=t.ajaxOptions(e,i,n),r.success=function(e){return Ember.run(null,a,e)},r.error=function(e){return Ember.run(null,o,t.ajaxError(e))},Ember.$.ajax(r)})},ajaxError:function(e){var i=this._super(e),r={};if(e&&422===e.status){var t=Ember.$.parseJSON(e.responseText).errors;return forEach(Ember.keys(t),function(e){r[Ember.String.camelize(e)]=t[e]}),new DS.InvalidError(r)}return e&&404===e.status?(r["404"]="Not Found",new DS.InvalidError(r)):i}}),DS.EmbeddedInModel=DS.Model.extend(DS.EmbeddedInModelMixin),DS.EmbeddedSerializer=DS.RESTSerializer.extend(DS.UnderscoredSerializer,DS.EmbeddedMixin),Ember.onLoad("Ember.Application",function(e){e.initializer({name:"embeddedAdapter",initialize:function(e,i){i.register("serializer:_embedded",DS.EmbeddedSerializer),i.register("adapter:_embedded",DS.EmbeddedAdapter)}})}),DS.ModelWithEmbedded=DS.Model.extend(DS.ModelWithEmbeddedMixin),function(e,i){i.EmbeddedInModelMixin=e.Mixin.create({embeddedDirtyTracker:function(e,i){var r=this;return"root.loaded.updated.uncommitted"===this.get(i)?this.eachRelationship(function(e){var i;return i=r.get(e),null!=i&&i.toString().indexOf("Promise")<0?i.transitionTo("updated.uncommitted"):void 0}):void 0}.observes("currentState.stateName")})}(Ember,DS),function(e,i){function r(e){return e&&("always"===e.embedded||"load"===e.embedded)}function t(e){return e&&"ids"===e.embedded}function n(e,i){var r=e+"_id";i.hasOwnProperty(r)&&delete i[r]}function a(e,i,t,n){var a=s(this,"attrs");a&&i.eachRelationship(function(i,s){var l=a[i];r(l)&&("hasMany"===s.kind&&o.call(this,e,i,s,t,n),"belongsTo"===s.kind&&d.call(this,e,i,s,t,n))},this)}function o(i,r,t,n,o){var d=i.serializerFor(t.type.typeKey),u=s(this,"primaryKey"),c=t.type.typeKey,p="_"+e.String.pluralize(c),y=this.keyForRelationship(r,t.kind),h=this.keyForAttribute(r),m=[];o[h]&&(n[p]=n[p]||[],l(o[h],function(e){var r=i.modelFor(c);a.call(d,i,r,n,e),m.push(e[u]),n[p].push(e)}),o[y]=m,delete o[h])}function d(i,t,n,o,d){var l=this.get("attrs");if(l&&(r(l[e.String.camelize(t)])||r(l[t]))){var u=n.type.typeKey,c=i.serializerFor(n.type.typeKey),p=(s(c,"primaryKey"),e.String.pluralize(u)),y=c.keyForRelationship(t,n.kind),h=c.keyForAttribute(t);if(d[h]){o[p]=o[p]||[];var m=i.modelFor(n.type.typeKey);for(var f in d)d.hasOwnProperty(f)&&f.camelize()===u&&a.call(c,i,m,o,d[f]);d[y]=d[h].id,o[p].push(d[h]),d[h][n.parentType.typeKey+"_id"]=d.id,delete d[h]}}}var s=e.get,l=e.EnumerableUtils.forEach;i.EmbeddedMixin=e.Mixin.create({serializeBelongsTo:function(e,i,t){var a=t.key,o=this.get("attrs");if(!o||!r(o[a]))return this._super(e,i,t),void 0;var d=this.keyForAttribute(a),s=e.get(a);if(s){i[d]=s.serialize();var l=s.get("id");l&&(i[d].id=l);var u=this.keyForAttribute(t.parentType.typeKey);u&&n(u,i[d]),delete i[d][u]}else i[d]=null},serializeHasMany:function(e,i,n){var a,o=n.key,d=this.get("attrs");return d&&(r(d[o])||t(d[o]))?(t(d[o])?(a=this.keyForRelationship(o,n.kind),i[a]=s(e,o).mapBy(s(this,"primaryKey"))):(a=this.keyForAttribute(o),i[a]=s(e,o).map(function(e){var i=e.serialize(),r=s(this,"primaryKey");return i[r]=s(e,r),null===i.id&&delete i.id,i},this)),void 0):(this._super(e,i,n),void 0)},extractSingle:function(e,i,r,t,n){var o=this.keyForAttribute(i.typeKey),d=r[o];return a.call(this,e,i,r,d),this._super(e,i,r,t,n)},extractArray:function(i,r,t){var n=this.keyForAttribute(r.typeKey),o=t[e.String.pluralize(n)];return l(o,function(e){a.call(this,i,r,t,e)},this),this._super(i,r,t)}})}(Ember,DS),function(e,i){i.UnderscoredAdapterMixin=e.Mixin.create({pathForType:function(i){var r=e.String.decamelize(i);return e.String.pluralize(r)}})}(Ember,DS),function(e,i){var r=e.get,t=e.EnumerableUtils.forEach;i.UnderscoredSerializer=e.Mixin.create({keyForAttribute:function(i){return e.String.decamelize(i)},keyForRelationship:function(i,r){return i=e.String.decamelize(i),"belongsTo"===r?i+"_id":"hasMany"===r?e.String.singularize(i)+"_ids":i},serializeIntoHash:function(i,r,t,n){var a=e.String.decamelize(r.typeKey);i[a]=this.serialize(t,n)},serializePolymorphicType:function(i,t,n){var a=n.key,o=r(i,a);o&&(a=this.keyForAttribute(a),t[a+"_type"]=e.String.capitalize(o.constructor.typeKey))},typeForRoot:function(i){var r=e.String.camelize(i);return e.String.singularize(r)},normalize:function(e,i,r){return this.normalizeLinks(i),this._super(e,i,r)},normalizeLinks:function(i){if(i.links){var r=i.links;for(var t in r){var n=e.String.camelize(t);n!==t&&(r[n]=r[t],delete r[t])}}},normalizeRelationships:function(e,i){var r,n;this.keyForRelationship&&e.eachRelationship(function(e,a){if(a.options.polymorphic){if(r=this.keyForAttribute(e),n=i[r],n&&n.type)n.type=this.typeForRoot(n.type);else if(n&&"hasMany"===a.kind){var o=this;t(n,function(e){e.type=o.typeForRoot(e.type)})}}else r=this.keyForRelationship(e,a.kind),n=i[r];i[e]=n,e!==r&&delete i[r]},this)}})}(Ember,DS);