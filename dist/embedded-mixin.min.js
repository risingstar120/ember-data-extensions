!function(e,t){function i(e){return e&&("always"===e.embedded||"load"===e.embedded)}function r(e,t){var i=e+"_id";t.hasOwnProperty(i)&&delete t[i]}function a(e,t,r,a){var y=l(this,"attrs");y&&t.eachRelationship(function(t,l){var o=y[t];i(o)&&("hasMany"===l.kind&&n.call(this,e,t,l,r,a),"belongsTo"===l.kind&&s.call(this,e,t,l,r,a))},this)}function n(t,i,r,n,s){var o=t.serializerFor(r.type.typeKey),u=l(this,"primaryKey"),p=r.type.typeKey,h="_"+e.String.pluralize(p),d=this.keyForRelationship(i,r.kind),c=this.keyForAttribute(i),f=[];s[c]&&(n[h]=n[h]||[],y(s[c],function(e){var i=t.modelFor(p);a.call(o,t,i,n,e),f.push(e[u]),n[h].push(e)}),s[d]=f,delete s[c])}function s(t,r,n,s,y){var o=this.get("attrs");if(o&&(i(o[e.String.camelize(r)])||i(o[r]))){var u=n.type.typeKey,p=t.serializerFor(n.type.typeKey),h=(l(p,"primaryKey"),e.String.pluralize(u)),d=p.keyForRelationship(r,n.kind),c=p.keyForAttribute(r);if(y[c]){s[h]=s[h]||[];var f=t.modelFor(n.type.typeKey);for(var v in y)y.hasOwnProperty(v)&&v.camelize()===u&&a.call(p,t,f,s,y[v]);y[d]=y[c].id,s[h].push(y[c]),y[c][n.parentType.typeKey+"_id"]=y.id,delete y[c]}}}var l=e.get,y=e.EnumerableUtils.forEach;t.EmbeddedMixin=e.Mixin.create({serializeBelongsTo:function(e,t,a){var n=a.key,s=this.get("attrs");if(!s||!i(s[n]))return this._super(e,t,a),void 0;var l=this.keyForAttribute(n),y=e.get(n);if(y){t[l]=y.serialize();var o=y.get("id");o&&(t[l].id=o);var u=this.keyForAttribute(a.parentType.typeKey);u&&r(u,t[l]),delete t[l][u]}else t[l]=null},serializeHasMany:function(e,t,r){var a=r.key,n=this.get("attrs");if(!n||!i(n[a]))return this._super(e,t,r),void 0;var s=this.keyForAttribute(a);t[s]=l(e,a).map(function(e){var t=e.serialize(),i=l(this,"primaryKey");return t[i]=l(e,i),null===t.id&&delete t.id,t},this)},extractSingle:function(e,t,i,r,n){var s=this.keyForAttribute(t.typeKey),l=i[s];return a.call(this,e,t,i,l),this._super(e,t,i,r,n)},extractArray:function(t,i,r){var n=this.keyForAttribute(i.typeKey),s=r[e.String.pluralize(n)];return y(s,function(e){a.call(this,t,i,r,e)},this),this._super(t,i,r)}})}(Ember,DS);